# application.yml in api-gateway

server:
  port: 9000

spring:
  application:
    name: api-gateway
  # ADD THIS LINE TO IMPORT YOUR SECRETS
  config:
    import: "optional:classpath:application-secrets.properties"
  cloud:
    gateway:
      forwarded:
        enabled: true
      # ... rest of the file remains the same
      routes:
        - id: auth-service
          uri: lb://AUTH-SERVICE
          predicates:
            - Path=/api/auth/**, /api/users/**

        - id: user-profile-service
          uri: lb://USER-PROFILE-SERVICE
          predicates:
            - Path=/api/profiles/**, /api/specialities/**, /api/doctors/**

        - id: consultation-service
          uri: lb://CONSULTATION-SERVICE
          predicates:
            - Path=/api/consultations/**
#
#        - id: chat-service-websocket
#          uri: lb:ws://CHAT-SERVICE
#          predicates:
#            - Path=/ws/**
#          filters:
#            # This is the crucial fix:
#            # It forces the gateway to use the 'ws' scheme for the downstream request.
#            - SetScheme=ws
#
        - id: chat-service-rest
          uri: lb://CHAT-SERVICE
          predicates:
            - Path=/api/chat/**

eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka

# The 'jwt.secret' placeholder will now be resolved from the imported file
jwt:
  secret: ${jwt.secret}

logging:
  level:
    org.springframework.cloud.gateway: TRACE
    reactor.netty.http.client: TRACE